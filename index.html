<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=3.0">
    <meta charset="UTF-8">
    <title>Play Sound Every X Minutes</title>
</head>
<body>
<h2>v1.0.3</h2>
<button onclick="startPlaying()">Start</button>
<br>
<button onclick="stopPlaying()">Stop</button>
<div id="timer">***</div>
<div id="total">Total time: 00:00</div>

<script>
    let intervalID;
    let cycleTime = 60;
    let timeLeft = cycleTime;
    let wakeLock = null;
    let startTime;

    async function playSound() {
        const audio = new Audio('singing-bowl-gong-69238.mp3');
        audio.play();
    }

    function formatTime(seconds) {
        if (seconds < 0 || seconds === undefined || isNaN(seconds))
            seconds = 0; // Prevent negative time
        let minutes = Math.floor(seconds / 60);
        let remainingSeconds = seconds % 60;
        return (minutes < 10 ? '0' : '') + minutes + ':' + (remainingSeconds < 10 ? '0' : '') + remainingSeconds;
    }

    function updateTimer() {
        let elapsed = Math.floor((Date.now() - startTime) / 1000); // Total seconds elapsed
        timeLeft = cycleTime - elapsed;
        document.getElementById('timer').textContent = formatTime(timeLeft);
        document.getElementById('total').textContent = 'Total time: ' + formatTime(elapsed);
    }

    function countdown() {
        if (timeLeft <= 0) {
            playSound();
            startTime = Date.now(); // reset start time
        }
        updateTimer();
    }

    async function startPlaying() {
        playSound();
        startTime = Date.now(); // Record start time
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request("screen");
        }
        intervalID = setInterval(countdown, 1000); // update timer every second
        updateTimer(); // Initial call to update both timers
    }

    async function stopPlaying() {
        clearInterval(intervalID);
        timeLeft = cycleTime;
        updateTimer();
        if (wakeLock !== null) {
            await wakeLock.release();
            wakeLock = null;
        }
    }

    updateTimer(); // Initial update for both timers
</script>

</body>
</html>